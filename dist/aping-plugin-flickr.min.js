/**
    @name: aping-plugin-flickr 
    @version: 0.7.8 (28-01-2016) 
    @author: Jonathan Hornung 
    @url: https://github.com/JohnnyTheTank/apiNG-plugin-flickr 
    @license: MIT
*/
"use strict";angular.module("jtt_aping_flickr",["jtt_flickr"]).directive("apingFlickr",["apingFlickrHelper","apingUtilityHelper","flickrFactory",function(a,b,c){return{require:"?aping",restrict:"A",replace:"false",link:function(d,e,f,g){var h=g.getAppSettings(),i=b.parseJsonFromAttributes(f.apingFlickr,a.getThisPlatformString(),h);i.forEach(function(b){var d={model:h.model};if("undefined"!=typeof b.items?d.items=b.items:d.items=h.items,"undefined"!=typeof h.getNativeData?d.getNativeData=h.getNativeData:d.getNativeData=!1,0===d.items||"0"===d.items)return!1;(d.items<0||isNaN(d.items))&&(d.items=void 0),d.items>20&&(d.items=20);var e={items:d.items};"undefined"!=typeof b.language&&(e.lang=b.language),b.userId?(e.id=b.userId,c.getImagesFromUserById(e).then(function(b){g.concatToResults(a.getObjectByJsonData(b,d))})):b.tags&&(e.tags=b.tags,b.tagmode&&(e.tagmode=b.tagmode),c.getImagesByTags(e).then(function(b){g.concatToResults(a.getObjectByJsonData(b,d))}))})}}}]),angular.module("jtt_aping_flickr").service("apingFlickrHelper",["apingModels","apingTimeHelper","apingUtilityHelper",function(a,b,c){this.getThisPlatformString=function(){return"flickr"},this.getThisPlatformLink=function(){return"http://flickr.com/"},this.getUserNameFromString=function(a){var b=a.replace("nobody@flickr.com (","");return b=b.substr(0,b.length-1)},this.removeOverHeadFromDescription=function(a){if(angular.isDefined(a)&&"string"==typeof a){var b=a.split("posted a photo:");b.length>1&&(a=b[1].trim()),""===a&&(a=void 0)}return a},this.getObjectByJsonData=function(a,b){var c=[];if(a){var d=this;a.data&&a.data.items&&angular.forEach(a.data.items,function(a,e){if(angular.isUndefined(b.items)||b.items>0&&c.length<b.items){var f=d.getItemByJsonData(a,b);f&&c.push(f)}})}return c},this.getItemByJsonData=function(a,b){var c={};if(a&&b.model)if(b.getNativeData===!0||"true"===b.getNativeData)c=this.getNativeItemByJsonData(a);else switch(b.model){case"social":c=this.getSocialItemByJsonData(a);break;case"image":c=this.getImageItemByJsonData(a);break;default:return!1}return c},this.getSocialItemByJsonData=function(d){var e=a.getNew("social",this.getThisPlatformString());return angular.extend(e,{blog_name:d.author?this.getUserNameFromString(d.author):void 0,blog_id:d.author_id||void 0,blog_link:d.author_id?this.getThisPlatformLink()+d.author_id:void 0,timestamp:b.getTimestampFromDateString(d.published,1e3,36e5),post_url:d.link,intern_id:d.link.split("flickr.com").length>=2?d.link.split("flickr.com")[1]:void 0,thumb_url:d.media?d.media.m:void 0,img_url:d.media?d.media.m.replace("_m.","."):void 0}),e.native_url=e.img_url,e.text=d.description?this.removeOverHeadFromDescription(c.getTextFromHtml(d.description)):void 0,d.title&&(e.text?e.caption=d.title:e.text=d.title),e.date_time=new Date(e.timestamp),d.description.indexOf("posted a photo")>-1?(e.type="image",e):!1},this.getImageItemByJsonData=function(d){var e=a.getNew("image",this.getThisPlatformString());return angular.extend(e,{blog_name:d.author?this.getUserNameFromString(d.author):void 0,blog_id:d.author_id||void 0,blog_link:d.author_id?this.getThisPlatformLink()+d.author_id:void 0,timestamp:b.getTimestampFromDateString(d.published,1e3,36e5),post_url:d.link,intern_id:d.link.split("flickr.com").length>=2?d.link.split("flickr.com")[1]:void 0,thumb_url:d.media?d.media.m:void 0,img_url:d.media?d.media.m.replace("_m.","."):void 0}),e.native_url=e.img_url,e.text=d.description?this.removeOverHeadFromDescription(c.getTextFromHtml(d.description)):void 0,d.title&&"untitled"!==d.title.toLowerCase()&&(e.text?e.caption=d.title:e.text=d.title),e.date_time=new Date(e.timestamp),d.description.indexOf("posted a photo")<=0?!1:e},this.getNativeItemByJsonData=function(a){return a.description.indexOf("posted a photo")<=0?!1:a}}]),angular.module("jtt_flickr",[]).factory("flickrFactory",["$http","flickrSearchDataService",function(a,b){var c={};return c.getImagesFromUserById=function(c){var d=b.getNew("imagesFromUserById",c);return a({method:"JSONP",url:d.url,params:d.object})},c.getImagesFromGroupOfUsersByIds=function(c){var d=b.getNew("imagesFromGroupOfUsersByIds",c);return a({method:"JSONP",url:d.url,params:d.object})},c.getImagesByTags=function(c){var d=b.getNew("imagesByTags",c);return a({method:"JSONP",url:d.url,params:d.object})},c}]).service("flickrSearchDataService",function(){this.getApiBaseUrl=function(a){return"http://api.flickr.com/services/feeds/photos_public.gne"},this.fillDataInObjectByList=function(a,b,c){return angular.forEach(c,function(c,d){"undefined"!=typeof b[c]&&(a.object[c]=b[c])}),a},this.getNew=function(a,b){var c={object:{jsoncallback:"JSON_CALLBACK",format:"json"},url:""};switch(a){case"imagesFromUserById":c=this.fillDataInObjectByList(c,b,["lang","id"]),c.url=this.getApiBaseUrl();break;case"imagesFromGroupOfUsersByIds":c=this.fillDataInObjectByList(c,b,["lang","ids"]),c.url=this.getApiBaseUrl();break;case"imagesByTags":c=this.fillDataInObjectByList(c,b,["lang","tags","tagmode"]),c.url=this.getApiBaseUrl()}return c}});