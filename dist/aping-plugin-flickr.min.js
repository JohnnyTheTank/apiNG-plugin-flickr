
/*! aping-plugin-flickr v0.1.7 (19-12-2015) by Jonathan Hornung */
"use strict";var jjtApingFlickr=angular.module("jtt_aping_flickr",["jtt_flickr"]).directive("apingFlickr",["apingFlickrHelper","apingUtilityHelper","flickrFactory",function(a,b,c){return{require:"?aping",restrict:"A",replace:"false",link:function(d,e,f,g){var h=g.getAppSettings(),i=b.parseJsonFromAttributes(f.apingFlickr,a.getThisPlattformString(),h);i.forEach(function(b){var d={model:h.model};"undefined"!=typeof b.items?d.items=b.items:d.items=h.items,"undefined"!=typeof h.getNativeData?d.getNativeData=h.getNativeData:d.getNativeData=!1;var e={items:d.items};"undefined"!=typeof b.language&&(e.lang=b.language),b.userId?(e.id=b.userId,c.getImagesFromUserById(e).success(function(b){g.concatToResults(a.getObjectByJsonData(b,d))}).error(function(a){})):b.tags&&(e.tags=b.tags,b.tagmode&&(e.tagmode=b.tagmode),c.getImagesByTags(e).success(function(b){g.concatToResults(a.getObjectByJsonData(b,d))}).error(function(a){}))})}}}]);jjtApingFlickr.service("apingFlickrHelper",["apingModels","apingTimeHelper","apingUtilityHelper",function(a,b,c){this.getThisPlattformString=function(){return"flickr"},this.getThisPlattformLink=function(){return"http://flickr.com/"},this.getUserNameFromString=function(a){var b=!1;return b=a.replace("nobody@flickr.com (",""),b=b.substr(0,b.length-1)},this.getObjectByJsonData=function(a,b){var c=[];if(a){var d=this;a.items&&angular.forEach(a.items,function(a,e){if(b.items>0&&c.length<b.items){var f=d.getItemByJsonData(a,b);f&&c.push(f)}})}return c},this.getItemByJsonData=function(a,b){var c={};if(a&&b.model)if(b.getNativeData===!0||"true"===b.getNativeData)c=this.getNativeItemByJsonData(a);else switch(b.model){case"social":c=this.getSocialItemByJsonData(a);break;case"image":c=this.getImageItemByJsonData(a);break;default:return!1}return c},this.getSocialItemByJsonData=function(c){var d=a.getNew("social",this.getThisPlattformString());return $.extend(!0,d,{blog_name:c.author?this.getUserNameFromString(c.author):!1,blog_id:c.author_id||!1,blog_link:c.author_id?this.getThisPlattformLink()+c.author_id:!1,timestamp:b.getTimestampFromDateString(c.published,1e3,36e5),post_url:c.link,text:c.title,intern_id:c.link.split("flickr.com").length>=2?c.link.split("flickr.com")[1]:!1,img_url:c.media?c.media.m.replace("_m.","."):!1}),d.date_time=new Date(d.timestamp),c.description.indexOf("posted a photo")>-1?(d.type="image",d):!1},this.getImageItemByJsonData=function(c){var d=a.getNew("image",this.getThisPlattformString());return $.extend(!0,d,{blog_name:c.author||!1,blog_id:c.author_id||!1,blog_link:c.author_id?this.getThisPlattformLink()+c.author_id:!1,timestamp:b.getTimestampFromDateString(c.published,1e3,36e5),post_url:c.link,intern_id:c.link.split("flickr.com").length>=2?c.link.split("flickr.com")[1]:!1,img_url:c.media?c.media.m.replace("_m.","."):!1,text:c.description||!1}),c.title&&(d.text?d.caption=c.title:d.text=c.title),d.date_time=new Date(d.timestamp),c.description.indexOf("posted a photo")<=0?!1:d},this.getNativeItemByJsonData=function(a){var b={};return a.description.indexOf("posted a photo")<=0?!1:b=a}}]),angular.module("jtt_flickr",[]).factory("flickrFactory",["$http","flickrSearchDataService",function(a,b){var c={};return c.getImagesFromUserById=function(c){var d=b.getNew("imagesFromUserById",c);return a({method:"JSONP",url:d.url,params:d.object})},c.getImagesFromGroupOfUsersByIds=function(c){var d=b.getNew("imagesFromGroupOfUsersByIds",c);return a({method:"JSONP",url:d.url,params:d.object})},c.getImagesByTags=function(c){var d=b.getNew("imagesByTags",c);return a({method:"JSONP",url:d.url,params:d.object})},c}]).service("flickrSearchDataService",function(){this.getApiBaseUrl=function(a){return"http://api.flickr.com/services/feeds/photos_public.gne"},this.fillDataInObjectByList=function(a,b,c){return angular.forEach(c,function(c,d){"undefined"!=typeof b[c]&&(a.object[c]=b[c])}),a},this.getNew=function(a,b){var c={object:{jsoncallback:"JSON_CALLBACK",format:"json"},url:""};switch(a){case"imagesFromUserById":c=this.fillDataInObjectByList(c,b,["lang","id"]),c.url=this.getApiBaseUrl();break;case"imagesFromGroupOfUsersByIds":c=this.fillDataInObjectByList(c,b,["lang","ids"]),c.url=this.getApiBaseUrl();break;case"imagesByTags":c=this.fillDataInObjectByList(c,b,["lang","tags","tagmode"]),c.url=this.getApiBaseUrl()}return c}});